<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #cargando, #contenido {
      display: none;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }
    .formulario input {
      display: block;
      margin: 8px 0;
      padding: 6px;
      width: 100%;
      max-width: 300px;
    }
    .exportar, .eliminar, .formulario button {
      padding: 6px 12px;
      margin: 8px 0;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="login">
    <h2>BIENVENIDO</h2>
    <input type="text" id="usuario" placeholder="Usuario">
    <input type="password" id="contrasena" placeholder="ContraseÃ±a">
    <button onclick="iniciarSesion()">Entrar</button>
    <p id="mensaje" style="color: red;"></p>
  </div>

  <div id="cargando">
    <h2>Iniciando sesiÃ³n...</h2>
    <div class="spinner"></div>
  </div>

  <div id="contenido">
    <h1>GarantÃ­a 1.1 - Yo Smart</h1>

    <button class="exportar" onclick="exportTableToExcel('inventario', 'inventario_excel')">ðŸ“… Exportar a Excel</button>

    <table id="inventario">
      <thead>
        <tr>
          <th>FECHA DE ENTRADA</th>
          <th>EQUIPO</th>
          <th>IMEL</th>
          <th>PROBLEMA</th>
          <th>CLIENTE</th>
          <th>CEDULA</th>
          <th>TECNICO</th>
          <th>FECHA DE SALIDA</th>
          <th>ACCIÃ“N</th>
        </tr>
      </thead>
      <tbody>
        <!-- Registros dinÃ¡micos -->
      </tbody>
    </table>

    <div class="formulario">
      <h2>Agregar nuevo registro</h2>
      <input type="text" id="fechaEntrada" placeholder="Fecha de Entrada">
      <input type="text" id="equipo" placeholder="Equipo">
      <input type="text" id="imel" placeholder="IMEL">
      <input type="text" id="problema" placeholder="Problema">
      <input type="text" id="cliente" placeholder="Cliente">
      <input type="text" id="cedula" placeholder="CÃ©dula">
      <input type="text" id="tecnico" placeholder="TÃ©cnico">
      <input type="text" id="fechaSalida" placeholder="Fecha de Salida">
      <button onclick="agregarRegistro()">âž• Agregar al Inventario</button>
    </div>
  </div>

  <script>
    function iniciarSesion() {
      const usuario = document.getElementById("usuario").value;
      const contrasena = document.getElementById("contrasena").value;

      if (usuario === "felix" && contrasena === "1234") {
        document.getElementById("login").style.display = "none";
        document.getElementById("cargando").style.display = "block";

        setTimeout(() => {
          document.getElementById("cargando").style.display = "none";
          document.getElementById("contenido").style.display = "block";
        }, 2000);
      } else {
        document.getElementById("mensaje").textContent = "Usuario o contraseÃ±a incorrecta";
      }
    }

    function agregarRegistro() {
      const datos = {
        fechaEntrada: document.getElementById("fechaEntrada").value,
        equipo: document.getElementById("equipo").value,
        imel: document.getElementById("imel").value,
        problema: document.getElementById("problema").value,
        cliente: document.getElementById("cliente").value,
        cedula: document.getElementById("cedula").value,
        tecnico: document.getElementById("tecnico").value,
        fechaSalida: document.getElementById("fechaSalida").value
      };

      const tabla = document.getElementById("inventario").getElementsByTagName('tbody')[0];
      const nuevaFila = tabla.insertRow();
      Object.values(datos).forEach(valor => {
        const celda = nuevaFila.insertCell();
        celda.textContent = valor;
      });

      const celdaAccion = nuevaFila.insertCell();
      const boton = document.createElement("button");
      boton.textContent = "Eliminar";
      boton.className = "eliminar";
      boton.onclick = function () {
        eliminarFila(this);
      };
      celdaAccion.appendChild(boton);

      document.querySelectorAll(".formulario input").forEach(input => input.value = "");

      fetch('guardar_registro.php', {
        method: 'POST',
        body: JSON.stringify(datos),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(resultado => {
        if (resultado.status === 'ok') {
          console.log('Registro guardado correctamente');
        } else {
          alert('Error al guardar: ' + resultado.mensaje);
        }
      })
      .catch(error => {
        alert('Error en la conexiÃ³n con el servidor');
        console.error(error);
      });
    }

    function eliminarFila(boton) {
      const fila = boton.closest("tr");
      fila.remove();
    }

    function exportTableToExcel(tableID, filename = '') {
      const downloadLink = document.createElement("a");
      const dataType = 'application/vnd.ms-excel';
      const tableSelect = document.getElementById(tableID);
      const tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

      filename = filename ? filename + '.xls' : 'excel_data.xls';
      downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
      downloadLink.download = filename;
      downloadLink.click();
    }
  </script>

</body>
</html>

